# 文件夹注释工具开发任务清单

## 需求1: 创建基础数据结构和管理类
- **解决方案**: 设计数据模型和管理类，使用ScriptableObject存储数据，通过GUID关联文件夹
- **任务清单**:
  - [x] 1.1 创建`FolderCommentData.cs`类，定义注释数据结构
  - [x] 1.2 创建`FolderCommentsDatabase.cs`类，实现ScriptableObject数据容器
  - [x] 1.3 创建`FolderCommentManager.cs`类，实现单例模式的数据管理器
  - [x] 1.4 实现数据的加载和保存功能
  - [x] 1.5 实现通过GUID查找和更新注释数据的方法
- **注意事项**:
  - 确保数据结构包含标题、详细注释、颜色、创建时间和修改时间
  - 数据保存位置应在ProjectSettings目录下，确保不会被版本控制忽略

## 需求2: 实现Inspector面板中的注释编辑功能
- **解决方案**: 创建自定义Inspector，允许用户编辑文件夹注释
- **任务清单**:
  - [x] 2.1 创建`FolderCommentInspector.cs`类，继承自Editor
  - [x] 2.2 实现文件夹检测逻辑，只对文件夹资源显示注释编辑界面
  - [x] 2.3 设计并实现注释编辑UI，包括标题、颜色选择器和详细注释
  - [x] 2.4 实现注释数据的保存和更新逻辑
  - [x] 2.5 添加创建时间和修改时间的显示
- **注意事项**:
  - 确保UI布局美观，易于使用
  - 实现自动保存机制，避免数据丢失

## 需求3: 实现Project窗口中的注释显示
- **解决方案**: 使用EditorApplication.projectWindowItemOnGUI回调绘制注释
- **任务清单**:
  - [x] 3.1 创建`FolderCommentDrawer.cs`类，实现绘制逻辑
  - [x] 3.2 实现列表模式下的注释显示（右侧对齐）
  - [x] 3.3 实现图标模式下的注释显示（文件夹图标下方，文件名上方）
  - [x] 3.4 实现文字颜色自定义功能
  - [x] 3.5 处理文字裁剪和溢出情况
- **注意事项**:
  - 确保在不同视图模式下注释位置正确
  - 优化绘制性能，避免影响编辑器响应速度

## 需求4: 创建UI样式和工具类
- **解决方案**: 封装常用的UI样式和工具函数
- **任务清单**:
  - [x] 4.1 创建`FolderCommentStyles.cs`类，定义UI样式常量
  - [x] 4.2 创建`FolderCommentUtils.cs`类，实现工具函数
  - [x] 4.3 实现文字裁剪和测量功能
  - [x] 4.4 实现颜色转换和处理功能
- **注意事项**:
  - 确保样式一致性
  - 提供足够的工具函数，简化主要功能实现

## 需求5: 测试和优化
- **解决方案**: 创建测试用例，验证功能并优化性能
- **任务清单**:
  - [x] 5.1 创建测试场景，包含多种文件夹结构
  - [x] 5.2 测试不同视图模式下的注释显示
  - [x] 5.3 测试文件夹重命名和移动后的注释保留情况
  - [x] 5.4 添加测试辅助工具，一键添加测试注释模板
  - [ ] 5.5 性能测试，确保在大型项目中不影响编辑器性能
  - [ ] 5.6 修复发现的问题和优化性能瓶颈
- **注意事项**:
  - 创建足够复杂的测试用例，覆盖各种使用场景
  - 关注性能问题，特别是在大型项目中的表现

## 需求6: 添加设置面板
- **解决方案**: 在Project Settings中添加设置面板，提供全局配置选项
- **任务清单**:
  - [x] 6.1 创建`FolderCommentSettings.cs`类，定义设置数据结构
  - [x] 6.2 实现设置的加载和保存功能
  - [x] 6.3 创建设置面板UI，添加到Project Settings中
  - [x] 6.4 添加全局开关、文字大小、样式设置等功能
  - [x] 6.5 修改现有代码，使用设置中的配置
- **注意事项**:
  - 确保设置面板UI简洁明了，易于使用
  - 提供合理的默认值和恢复默认设置功能

## 需求7: 添加富文本支持
- **解决方案**: 为注释内容添加富文本支持，并提供富文本语法指引
- **任务清单**:
  - [x] 7.1 修改样式类，启用富文本支持
  - [x] 7.2 在设置中添加富文本开关选项
  - [x] 7.3 在Inspector面板中添加富文本语法指引
  - [x] 7.4 实现富文本标签插入功能
  - [x] 7.5 添加富文本语法说明
  - [x] 7.6 优化富文本标签插入功能，支持无选中文本时的插入
- **注意事项**:
  - 确保富文本语法指引简洁明了，易于使用
  - 提供常用的富文本标签，如粗体、斜体、颜色、大小等

## 需求8: 优化UI布局
- **解决方案**: 优化Inspector面板中的UI布局，提高用户体验
- **任务清单**:
  - [x] 8.1 将注释输入框调整为下一行满行显示
  - [x] 8.2 增加输入框高度，提供更大的编辑空间
  - [x] 8.3 优化富文本语法指引的布局
  - [x] 8.4 修复富文本标签点击无效的问题
  - [x] 8.5 修复富文本标签点击后不立即生效的问题
  - [x] 8.6 优化富文本标签在输入框编辑状态下的使用体验
- **注意事项**:
  - 确保UI布局简洁明了，易于使用
  - 提供足够的编辑空间，方便用户输入和编辑注释

## 需求9: 添加全局编辑模式
- **解决方案**: 添加全局编辑模式开关，优化非编辑模式下的注释显示
- **任务清单**:
  - [x] 9.1 在设置中添加编辑模式开关
  - [x] 9.2 实现编辑模式和查看模式的切换
  - [x] 9.3 优化非编辑模式下的注释显示
  - [x] 9.4 添加快速启用编辑模式的按钮
  - [x] 9.5 去除编辑模式禁用提醒，改为使用边框包裹内容
  - [x] 9.6 简化查看模式下的UI，移除编辑按钮
  - [x] 9.7 将标题和注释一起放到边框内，添加分隔线
  - [x] 9.8 删除启用富文本的设置，默认支持富文本
  - [x] 9.9 移除切换编辑模式时的弹窗，并确保切换后刷新UI
  - [x] 9.10 在设置面板中添加简约的编辑模式状态提醒
  - [x] 9.11 移除设置面板中的"应用设置"按钮，简化界面
- **注意事项**:
  - 确保非编辑模式下的注释显示更加美观和易读
  - 用边框包裹标题和注释内容，保持界面简洁
  - 确保编辑模式状态提醒简洁明了，避免过多的视觉元素

## 需求10: 优化空注释显示逻辑
- **解决方案**: 当文件夹注释为空时，inspector不显示任何注释相关内容
- **任务清单**:
  - [x] 10.1 修改DrawFolderCommentEditor方法，在查看模式下检查注释是否为空
  - [x] 10.2 添加空注释测试辅助方法，方便测试空注释显示效果
  - [ ] 10.3 测试空注释时的显示效果
  - [ ] 10.4 确保编辑模式下仍能正常添加注释
- **注意事项**:
  - 编辑模式下即使注释为空也要显示编辑界面，让用户能够添加注释
  - 查看模式下只有当标题或注释不为空时才显示UI
  - 确保逻辑简洁明了，不影响现有功能

## 需求11: 改为单文件夹编辑模式
- **解决方案**: 取消全局编辑模式开关，改为选中文件夹后在inspector面板右上角三个点菜单中添加"开启编辑模式"按钮，实现单文件夹编辑模式
- **任务清单**:
  - [x] 11.1 修改FolderCommentInspector，添加单文件夹编辑模式状态管理
  - [x] 11.2 在Inspector右上角添加菜单按钮，包含"开启编辑模式"选项
  - [x] 11.3 实现编辑模式下的保存和取消按钮
  - [x] 11.4 实现未保存修改的临时存储和管理
  - [x] 11.5 实现切换目标时自动退出编辑模式
  - [x] 11.6 修改设置面板，移除全局编辑模式开关
  - [x] 11.7 更新UI逻辑，基于单文件夹编辑状态显示不同界面
  - [x] 11.8 优化按钮样式，使用Unity标准样式而非花哨颜色
  - [x] 11.9 改用右键菜单实现编辑模式入口，保持Unity原生头部UI
  - [x] 11.10 代码优化：修复内存泄漏、缓存GUIStyle、清理冗余代码
  - [x] 11.11 简化富文本功能：移除自动填写按钮，改为可选择的文字说明
  - [x] 11.12 代码优化：提取常量、优化样式缓存、清理冗余代码
  - [x] 11.13 文档更新：更新所有文档以反映当前代码功能
  - [x] 11.14 README分离：区分工程README和插件README，明确不同目标用户
- **注意事项**:
  - 编辑模式只针对当前选中的单个文件夹
  - 未保存的修改在切换目标或退出编辑模式时会丢失
  - 保存按钮点击后立即保存并退出编辑模式
  - 确保用户体验流畅，避免意外丢失数据
  - 使用Unity标准的UI样式，保持与编辑器一致的外观
